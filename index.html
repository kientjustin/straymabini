<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- My stylesheet -->
    <link rel="stylesheet" href="style/stray.css">

    <!-- Google fonts (Radley) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Radley:ital@0;1&display=swap" rel="stylesheet">

    <!-- For favicon not found error 404 -->
    <link rel="icon" href="data:,">

    <title>Stray</title>
</head>
<body>
    <div class="box" id="box1">
        <div class="logo-search-bar">
            <div class="logo">
                <nav>
                    <img src="Assets/s_logo.png" alt="stray logo">
                </nav>
            </div>
            <div class="searchform">
                <form class="search-form">
                    <input type="text" placeholder="Search" class="search-box">
                    <button class="search-button">
                        üîç
                    </button>
                </form>
            </div>
        </div>
        <div>
            <h1>
                <span id="italic">Stray,</span>
                <span id="bold">Animal tracking</span>
                <span id="small-italic">in Mabini</span>
            </h1>
            <p id="first__hook">Let us monitor and keep wildlife healthy</p>
            <a id="report__toggle" href="reportpage.html"><em>Report a sighting</em></a>
        </div>
        <div>
            <a class="learn__more" href="learnmore.html">Learn more</a>
            <img id="learn__more__line" src="Assets/line.png" alt="line">
        </div>
    </div>

    <!-- 2nd section -->
    <div class="box" id="box2">
        <div>
            <h2>Sightings and Reports</h2>
        </div>
        <div id="sightings_container">
            <!-- Dynamic content will be inserted here -->
        </div>
        <div>
            <a id="report__toggle" href="reportpage.html">Publish a Report</a>
        </div>
    </div>

    <!-- 3rd section -->
    <div class="box" id="box3">
        <div>
            <h2>Endangered Animals in Mabini</h2>
        </div>
        <div class="endangered-animals-container">
            <div class="endangeredanimals">
                <img src="Assets/eagle.jpg" alt="image">
                <p style="font-size: 24px;"><strong> Philippine Eagle </strong><br><em> Pithecophaga jefferyi </em></p>
                <p><strong>Description:</strong> It is also known as the monkey-eating eagle, is one of the world's largest and rarest birds of prey, found only in the Philippines. 
                    With a wingspan of up to 2.2 meters and powerful talons, it is an apex predator that primarily hunts mammals, birds, and reptiles. 
                    This majestic eagle is critically endangered due to deforestation, hunting, and slow reproduction, as it lays only one egg every two years. 
                    Conservation efforts, led by the Philippine Eagle Foundation, focus on habitat protection, captive breeding, and community awareness. 
                    As the national bird of the Philippines, the eagle symbolizes the country‚Äôs rich biodiversity and the urgent need for wildlife conservation.
                </p>
            </div>
            <div class="endangeredanimals">
                <img src="Assets/hawksbill sea turtle.jpeg" alt="image">
                <p style="font-size: 24px;"><strong> Hawksbill Sea Turtle </strong><br><em> Fretmochelys imbricata </em></p>
                <p><strong>Description:</strong> The Hawksbill Sea Turtle is a critically endangered species of sea turtle. 
                    It has a distinctive hawk-like beak and a brownish-shell with overlapping scutes (scales). 
                    Adults typically grow up to 1.5 meters (4.9 feet) in length and weigh between 80-200 kilograms (180-440 pounds).
                </p>
            </div>
            <div class="endangeredanimals">
                <img src="Assets/whale shark.jpg" alt="image">
                <p style="font-size: 24px;"><strong> Whale Shark</strong><br><em> Rhincodon typus </em></p>
                <p><strong>Description:</strong> Vulnerable to extinction due to overfishing and habitat degradation. 
                    Whale sharks are the largest fish in the world, reaching up to 20 meters (66 feet) in length and weighing up to 34 metric tons. 
                    They are slow-moving filter feeders, feeding on plankton and small fish.
                </p>
            </div>
            <div class="endangeredanimals">
                <img src="Assets/dugong.jpg" alt="image">
                <p style="font-size: 24px;"><strong> Dugong</strong><br><em> Dugong dugon </em></p>
                <p><strong>Description:</strong> Vulnerable due to habitat loss, entanglement in fishing nets, and hunting. 
                    Dugongs are large marine mammals, reaching up to 3 meters (10 feet) in length and weighing up to 400 kilograms (882 pounds). 
                    They are herbivores, feeding on seagrasses and other marine plants.
                </p>
            </div>
            <div class="endangeredanimals">
                <img src="Assets/green sea turtle.jpg" alt="image">
                <p style="font-size: 24px;"><strong> Green Turtle</strong><br><em> Chelonia mydas </em></p>
                <p><strong>Description:</strong> Endangered due to habitat loss, pollution, and hunting for its meat and eggs. 
                    Green turtles are medium-sized, reaching up to 1.5 meters (4.9 feet) in length and weighing up to 200 kilograms (440 pounds). 
                    They have a greenish-brown shell and are herbivores, feeding on seaweeds and seagrasses.

                </p>
            </div>
            <div class="endangeredanimals">
                <img src="Assets/sperm whale.jpg" alt="image">
                <p style="font-size: 24px;"><strong> Sperm Whale</strong><br><em> Physeter macrocephalus </em></p>
                <p><strong>Description:</strong> Vulnerable due to habitat degradation, pollution, and overfishing. 
                    Sperm whales are the largest toothed predators, reaching up to 20 meters (66 feet) in length. 
                    They are found in all the world's oceans and are known for their massive heads, which contain a waxy substance called spermaceti. 
                    Sperm whales are social animals, living in large groups and communicating with each other using a variety of clicks and whistles.
                </p>
            </div>
            <div class="endangeredanimals">
                <img src="Assets/bottlenose dolphin.jpg" alt="image">
                <p style="font-size: 24px;"><strong> Bottlenose Dolphins</strong><br><em> Tursiops truncatus </em></p>
                <p><strong>Description:</strong> Bottlenose dolphins are one of the most common dolphin species found in the waters of Mabini. 
                    They are highly social, intelligent, and curious creatures, often swimming close to shore. 
                    Bottlenose dolphins are medium-sized, reaching up to 4 meters (13 feet) in length and weighing up to 650 kilograms (1,433 pounds). 
                    They have a distinctive curved dorsal fin and a rounded forehead. 
                    Bottlenose dolphins are known for their playful and friendly nature, and are often seen swimming in large groups.
                </p>
            </div>
            <div class="endangeredanimals">
                <img src="Assets/spinner dolphins.png" alt="image">
                <p style="font-size: 24px;"><strong> Spinner Dolphins</strong><br><em> Stenella longirostis </em></p>
                <p><strong>Description:</strong> Spinner dolphins are also found in the waters of Mabini, particularly in the offshore areas. 
                    They are known for their acrobatic leaps and spins, and are often seen swimming in large groups. 
                    Spinner dolphins are smaller than bottlenose dolphins, reaching up to 2.5 meters (8.2 feet) in length and weighing up to 170 kilograms (375 pounds). 
                    They have a slender build and a distinctive curved dorsal fin. 
                    Spinner dolphins are highly social and are known for their energetic and playful behavior.
                </p>
            </div>
            <div class="endangeredanimals">
                <img src="Assets/eagle ray.jpg" alt="image">
                <p style="font-size: 24px;"><strong> Eagle Rays</strong><br><em> Myliobatis aquila </em></p>
                <p><strong>Description:</strong> Eagle rays are common in the waters of Mabini, particularly in shallow, coastal areas. 
                    They have a distinctive eagle-like shape, with long, pointed snouts and large pectoral fins. 
                    Eagle rays are medium-sized, reaching up to 3 meters (10 feet) in width and weighing up to 230 kilograms (507 pounds). 
                    They have a brownish-gray color with white spots and are known for their graceful and majestic appearance. 
                    Eagle rays are bottom-dwellers and feed on small fish, crustaceans, and mollusks.
                </p>
            </div>
            <div class="endangeredanimals">
                <img src="Assets/mantra ray.jpg" alt="image">
                <p style="font-size: 24px;"><strong> Manta Rays</strong><br><em> Mantra birostris </em></p>
                <p><strong>Description:</strong> Manta rays can occasionally be spotted in the waters of Mabini, particularly during the months of May to October. 
                    They are known for their massive size, reaching up to 7 meters (23 feet) in width and weighing up to 2,300 kilograms (5,071 pounds). 
                    Manta rays have a distinctive black and white color pattern and are known for their impressive feeding behavior, where they swim with their mouths wide open to filter small fish and plankton. 
                    Manta rays are pelagic and migrate long distances in search of food and mates.
                </p>
            </div>
        </div>
    </div>

    <button onclick="backToTop()" id="backtotopbtn" class="back-to-top">
        ‚Üë
    </button>    

    <footer>
        &copy; 2025 Stray. All rights reserved.
    </footer>

    <script type="module">
        // Import the Supabase client
        import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

        // Your Supabase URL and API Key
        const supabaseUrl = "https://lqjdklsasxtbymuotugp.supabase.co";
        const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxxamRrbHNhc3h0YnltdW90dWdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI1MTAyMTEsImV4cCI6MjA1ODA4NjIxMX0.PpSYXKFdxrdLjrmx4rc0i2N9ztP6Y-GkcGxt_-tppYA";

        // Initialize Supabase client
        const supabase = createClient("https://lqjdklsasxtbymuotugp.supabase.co", supabaseKey);

        // Test if Supabase is connected
        console.log("‚úÖ Supabase Connected:", supabase);

        export { supabase };

        // Fetch and display reports
        async function fetchReports() {
    const { data, error } = await supabase
        .from('uploads')
        .select('*')
        .order('id', { ascending: false });

    if (error) {
        console.error('Error fetching reports:', error);
    } else {
        const sightingsContainer = document.getElementById('sightings_container');
        sightingsContainer.innerHTML = ''; // Clear previous reports
        data.forEach(report => {
            const reportElement = document.createElement('div');
            reportElement.classList.add('report-element'); // Apply new CSS class
            reportElement.innerHTML = `
                <h4><strong>Reporter:</strong> ${report.reporter_name}</h4><br>
                <strong>Animal Type:</strong> ${report.animal_type}<br>
                <strong>Location:</strong> ${report.location}<br>
                <strong>Status:</strong> ${report.status}<br>
                <strong>Date:</strong> ${new Date(report.report_date).toLocaleDateString()}<br>
                <strong>Description:</strong> ${report.description}<br>
            `;
            sightingsContainer.appendChild(reportElement);
        });
    }
}

        fetchReports();
    </script>

    <!-- Back to top function -->
    <script>
        // Function to show the back-to-top button when scrolling
        window.addEventListener('scroll', function () {
            const backToTopButton = document.getElementById('backtotopbtn');
            if (window.scrollY > 300) {
                backToTopButton.classList.add('visible'); // Show the button
            } else {
                backToTopButton.classList.remove('visible'); // Hide the button
            }
        });

        // Function to scroll the page back to the top
        function backToTop() {
            window.scrollTo({
                top: 0,
                behavior: "smooth"
            });
        }
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
        const searchInput = document.querySelector(".search-box");
        const searchButton = document.querySelector(".search-button");
        let highlightedElements = [];
        let currentIndex = -1;

        // Event listener for search button click
        searchButton.addEventListener("click", function (event) {
            event.preventDefault(); // Prevent form submission
            const searchTerm = searchInput.value.trim().toLowerCase();
            if (searchTerm === "") return;
            
            removeHighlights(); // Remove previous highlights
            highlightedElements = highlightText(document.body, searchTerm); // Highlight new search term
            currentIndex = -1;
            
            if (highlightedElements.length > 0) {
                scrollToNext(); // Scroll to the first match
                showNextButton(); // Show the next button
            }
        });

        // Function to highlight search term occurrences
        function highlightText(element, searchTerm) {
            let matches = [];
            if (element.nodeType === 3) { // If it's a text node
                const matchIndex = element.nodeValue.toLowerCase().indexOf(searchTerm);
                if (matchIndex !== -1) {
                    const span = document.createElement("span");
                    span.classList.add("highlight");
                    const word = element.nodeValue.substr(matchIndex, searchTerm.length);
                    span.textContent = word;
                    const after = element.splitText(matchIndex);
                    after.nodeValue = after.nodeValue.substr(searchTerm.length);
                    after.parentNode.insertBefore(span, after);
                    
                    matches.push(span);
                }
            } else if (element.nodeType === 1 && element.childNodes && !/(script|style)/i.test(element.tagName)) {
                element.childNodes.forEach(child => {
                    matches = matches.concat(highlightText(child, searchTerm));
                });
            }
            return matches;
        }

        // Function to remove all highlighted terms
        function removeHighlights() {
            document.querySelectorAll(".highlight").forEach(el => {
                const parent = el.parentNode;
                parent.replaceChild(document.createTextNode(el.textContent), el);
                parent.normalize(); // Merge text nodes
            });
            highlightedElements = [];
            hideNextButton(); // Hide the next button if no highlights exist
        }

        // Function to scroll to the next highlighted term
        function scrollToNext() {
            if (highlightedElements.length === 0) return;
            currentIndex = (currentIndex + 1) % highlightedElements.length; // Loop back to start if at the end
            highlightedElements[currentIndex].scrollIntoView({ behavior: "smooth", block: "center" });
        }

        // Function to show the "Next" button
        function showNextButton() {
            let nextButton = document.getElementById("nextHighlight");
            if (!nextButton) {
                nextButton = document.createElement("button");
                nextButton.id = "nextHighlight";
                nextButton.textContent = "Next";
                nextButton.style.position = "fixed";
                nextButton.style.bottom = "100px"; // Moved slightly higher
                nextButton.style.right = "20px";
                nextButton.style.padding = "10px 15px";
                nextButton.style.fontSize = "16px";
                nextButton.style.backgroundColor = "#007bff";
                nextButton.style.color = "white";
                nextButton.style.border = "none";
                nextButton.style.borderRadius = "5px";
                nextButton.style.cursor = "pointer";
                nextButton.style.boxShadow = "0px 4px 6px rgba(0, 0, 0, 0.1)";
                nextButton.style.zIndex = "1000";
                nextButton.addEventListener("click", scrollToNext); // Scroll to next match on click
                document.body.appendChild(nextButton);
            }
            nextButton.style.display = "block";
        }

        // Function to hide the "Next" button
        function hideNextButton() {
            const nextButton = document.getElementById("nextHighlight");
            if (nextButton) {
                nextButton.style.display = "none";
            }
        }
    });

    // CSS to add for highlighting effect
    const style = document.createElement("style");
    style.innerHTML = ".highlight { background-color: yellow; font-weight: bold; }";
    document.head.appendChild(style);
    </script>
</body>
</html>
